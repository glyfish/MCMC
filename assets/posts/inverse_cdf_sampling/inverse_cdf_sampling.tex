\documentclass[12pt]{article}
\usepackage[pdftex,pagebackref,colorlinks=true,pdfpagemode=none,urlcolor=blue,linkcolor=blue,citecolor=blue,pdfstartview=FitH]{hyperref}

\usepackage{amsmath,amsfonts}
\usepackage{graphicx}
\usepackage{color}
\usepackage{hyperref}
\usepackage{minted}
\usemintedstyle{bw}

\newcommand{\homedir}{\string~}

\setlength{\oddsidemargin}{0pt}
\setlength{\evensidemargin}{0pt}
\setlength{\textwidth}{6.0in}
\setlength{\topmargin}{0in}
\setlength{\textheight}{8.5in}

\setlength{\parindent}{0in}
\setlength{\parskip}{5px}

\input{\homedir/Develop/python/gly.fish/latex2wp/macrosblog.tex}

\title{Inverse CDF Sampling}
\author{Troy Stribling}


\begin{document}

% Introduction
\iftex
\maketitle
\section{Introduction}
\fi

Inverse \href{https://en.wikipedia.org/wiki/Cumulative_distribution_function}{CDF} sampling is a method for obtaining samples from both discrete and continuous probability distributions
that requires the CDF to be invertable.
The method generates a CDF value from a Uniform random variable on [0, 1] that is then used as input
into the inverted CDF to generate a sample
with the desired distribution. Here examples for both cases are discussed.
For the continuous case a proof is given that demonstrates the samples produced have the expected distribution.


% Sampling discrete distributions
\ifblog
<h2>Sampling Discrete Distributions</h2>
\fi
\iftex
\section{Sampling Discrete Distributions}
\fi

A discrete probability distribution consisting of a finite set of $N$ probability values is defined by,

$$\{p_1, p_2,\ldots,p_N\}$$

with $p_i \geq 0, \forall i$ and $\sum_{i=1}^N{p_i} = 1.$

The CDF specifies the probability that $i \leq n$ and is given by,
\begin{equation}
\label{eq:discrete_cdf}
P(i \leq n)=P(n)=\sum_{i=1}^n{p_i},
\end{equation}
where $P(N)=1.$

For a given generated CDF value, $u$, equation (\ref{eq:discrete_cdf}) can always be inverted by evaluating it for each $n$ and
searching for the value of $n$ that satisfies, $P(n) \geq u.$ It can be seen that the generated samples will have
distribution $\{p_n\}$ since the intervals $P(n) - P(n-1) = p_n$ are Uniformly sampled.

Consider the distribution,

\begin{equation} 
\label{eq:discrete}
\left \{\frac{1}{12}, \frac{1}{12}, \frac{1}{6}, \frac{1}{6}, \frac{1}{12}, \frac{5}{12} \right\}
\end{equation}

It is shown in the following plot with its CDF.

\ifblog
\image{width = 600}{https://gly.fish/wp-content/uploads/posts/inverse-cdf-sampling/discrete_cdf.png}{\homedir/Develop/python/gly.fish/assets/posts/inverse_cdf_sampling/discrete_cdf.png}
\fi
\iftex
\image{width = 400}{https://gly.fish/wp-content/uploads/posts/inverse-cdf-sampling/discrete_cdf.png}{\homedir/Develop/python/gly.fish/assets/posts/inverse_cdf_sampling/discrete_cdf.png}
\fi

A sampler using the Inverse CDF method can be implemented in Python in a few lines of code,

% Sampler code examples
\ifblog
<pre class="lang:python">
import numpy

n = 10000
df = numpy.array([1/12, 1/12, 1/6, 1/6, 1/12, 5/12])
cdf = numpy.cumsum(df)

cdf_star = numpy.random.rand(n)
samples = [numpy.flatnonzero(cdf >= cdf_star[i])[0] for i in range(n)]
</pre>
\fi

\iftex
\begin{minted}[mathescape, frame=lines, framesep=2mm, fontsize=\footnotesize]{python}
import numpy

n = 10000
df = numpy.array([1/12, 1/12, 1/6, 1/6, 1/12, 5/12])
cdf = numpy.cumsum(df)

cdf_star = numpy.random.rand(n)
samples = [numpy.flatnonzero(cdf >= cdf_star[i])[0] for i in range(n)]
\end{minted}
\fi

The figure below favoably compares samples generated by the Inverse CDF sampler and distribution (\ref{eq:discrete}),
\ifblog
\image{width = 600}{https://gly.fish/wp-content/uploads/posts/inverse-cdf-sampling/discrete_sampled_distribution.png}{\homedir/Develop/python/gly.fish/assets/posts/inverse_cdf_sampling/discrete_sampled_distribution.png}
\fi
\iftex
\image{width = 400}{https://gly.fish/wp-content/uploads/posts/inverse-cdf-sampling/discrete_sampled_distribution.png}{\homedir/Develop/python/gly.fish/assets/posts/inverse_cdf_sampling/discrete_sampled_distribution.png}
\fi


% multinomial sampling
\ifblog
It is also possible to directly sample $\{p_n\}$ using the <code>multinomial</code> sampler from
<code>numpy</code>,

<pre class="lang:python">
import numpy

n = 10000
df = numpy.array([1/12, 1/12, 1/6, 1/6, 1/12, 5/12])
samples = numpy.random.multinomial(n, df, size=1)/n
</pre>
\fi

\iftex
It is also possible to directly sample $\{p_n\}$ using the \mintinline{python}{multinomial} sampler from
\mintinline{python}{numpy},

\begin{minted}[mathescape, frame=lines, framesep=2mm,fontsize=\footnotesize]{python}
import numpy

n = 10000
df = numpy.array([1/12, 1/12, 1/6, 1/6, 1/12, 5/12])
samples = numpy.random.multinomial(n, df, size=1)/n
\end{minted}
\fi

% Sampling continuous distributions
\ifblog
<h2>Sampling Continuous Distributions</h2>
\fi
\iftex
\section{Sampling Continuous Distributions}
\fi

A continuous probability distribution is defined by the  \href{https://en.wikipedia.org/wiki/Probability_density_function}{PDF},

$$f_X(x),$$

where $f_X(x) \geq 0, \forall x$ and $\int f_X(x) dx = 1.$

The CDF is a monotonically increasing function that specifies probability that $X \leq x$,
\begin{equation}
P(X \leq x) = F_X(x) = \int^{x} f_X(w) dw
\label{eq:continuous_cdf}
\end{equation}

To prove that Inverse CDF sampling works is is necessary to show that,

$$P[F_X^{-1}(u) \leq x] = F_X(x),$$

where $F_X^{-1}(x)$ is the inverse of $F_X(x)$ and $u$ is Uniform on [0, 1]. Since $F_X(x)$ is monitonically increasing,

\begin{align}
P[F_X^{-1}(u) \leq x] & = & P[F_X(F_X^{-1}(u)) \leq F_X(x)] \\
& = & P[u \leq F_X(x)] \\
& = &\int_{0}^{F_X(x)} dw \\
& = & F_X(x)
\end{align}

and the desired result is obtained.


\end{document}
